# pyIRCX WebChat HTTPS Configuration
# Copy this file to /etc/httpd/conf.d/ssl-webchat.conf (RHEL/Fedora)
# or /etc/apache2/sites-available/ssl-webchat.conf (Debian/Ubuntu)
#
# Replace YOUR_DOMAIN with your actual domain name
# Replace certificate paths with your actual certificate locations

<VirtualHost *:443>
    ServerName YOUR_DOMAIN
    DocumentRoot /var/www/html

    SSLEngine on
    # Let's Encrypt certificates (adjust paths for your domain)
    SSLCertificateFile /etc/letsencrypt/live/YOUR_DOMAIN/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/YOUR_DOMAIN/privkey.pem

    # Modern SSL configuration
    SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
    SSLHonorCipherOrder off

    # WebSocket proxy for secure WebSocket (wss://)
    ProxyPreserveHost On
    ProxyRequests Off
    ProxyAddHeaders On

    # Pass real client IP to backend (supports IPv4 and IPv6)
    # These headers are used by the gateway for WEBIRC
    RequestHeader set X-Forwarded-For "%{REMOTE_ADDR}s"
    RequestHeader set X-Real-IP "%{REMOTE_ADDR}s"
    RequestHeader set X-Forwarded-Proto "https"

    # Proxy WebSocket connections to the gateway
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/ws$ ws://127.0.0.1:8765/ [P,L]

    # Configure proxy for /ws path
    <Location /ws>
        ProxyPass ws://127.0.0.1:8765/
        ProxyPassReverse ws://127.0.0.1:8765/
    </Location>

    <Directory /var/www/html>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

    ErrorLog logs/webchat-ssl-error.log
    CustomLog logs/webchat-ssl-access.log combined
</VirtualHost>
